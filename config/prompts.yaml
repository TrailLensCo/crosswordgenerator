# AI Prompt Configuration for Crossword Generator
# All prompts used by the system are defined here
# Variables in {{double_braces}} are substituted at runtime

version: "1.0"

# Default settings applied to all prompts unless overridden
model_defaults:
  model: null                    # Use main config default if null
  temperature: 0.7
  max_tokens: 16384

prompts:
  # ============================================================
  # THEMED WORD LIST GENERATION
  # Called at start to generate topic-specific vocabulary
  # ============================================================
  themed_word_list:
    name: "Generate Themed Word List"
    description: "Creates initial vocabulary list related to the puzzle topic"
    max_calls: 3

    model: "claude-opus-4-5-20251101"  # Use Opus for better creativity in themed words
    temperature: 0.7
    max_tokens: 16384

    system: |
      You are an expert crossword puzzle constructor with deep knowledge of
      {{topic}} and crossword conventions. Generate words that are:
      - Factually accurate and culturally respectful
      - Appropriate for crossword puzzles (no obscure abbreviations)
      - Varied in length to fit different grid positions
      - Interesting and educational for solvers

    user: |
      Generate a themed word list for a {{difficulty}} difficulty crossword
      puzzle about "{{topic}}".

      Requirements:
      - Puzzle type: {{puzzle_type}}
      - Grid size: {{size}}x{{size}}
      - Target word count: {{target_word_count}} words
      - Minimum word length: 3 letters
      - Maximum word length: {{max_word_length}} letters

      CRITICAL - Word Length Distribution:
      Generate a natural mix that favors shorter words for better grid solvability.
      The exact distribution depends on grid size and max_word_length={{max_word_length}}:

      For grids with max_word_length <= 7 (small grids like 5x5, 7x7):
        - 70-75% should be 3-5 letters (short fill)
        - 25-30% should be 6-{{max_word_length}} letters (longer entries)

      For grids with max_word_length 8-11 (medium grids like 9x9, 11x11):
        - 60-65% should be 3-7 letters (short fill)
        - 30-35% should be 8-{{max_word_length}} letters (medium/long entries)
        - A few at maximum length for potential theme entries

      For grids with max_word_length >= 13 (large grids like 15x15, 21x21):
        - 60-65% should be SHORT: 3-7 letters (fill words)
        - 25-30% should be MEDIUM: 8-12 letters (standard entries)
        - 10% should be LONG: 13-{{max_word_length}} letters (theme entries)

      This distribution ensures the puzzle is solvable. Ultra-long words are rare in
      English and create over-constrained grids. Focus on shorter, crossword-friendly words.

      For each word, provide:
      1. The word (uppercase, no spaces)
      2. A {{difficulty}}-appropriate clue
      3. Word length
      4. Category (theme_entry, revealer, fill, or proper_noun)
      5. Difficulty score (1-5)

      Focus on these aspects of {{topic}}:
      {{topic_aspects}}

      IMPORTANT: Include 4-6 potential theme entries close to the maximum word length
      ({{max_word_length}} letters or slightly shorter) that could serve as the puzzle's
      featured answers. These should be in the longest length category for this grid size.

    output_format:
      type: yaml
      schema: |
        words:
          - word: "WORD"
            clue: "Clue text here"
            length: 4
            category: fill
            difficulty: 2

        suggested_theme_entries:
          - word: "LONGERWORD"
            clue: "Theme-related clue"
            theme_connection: "How it connects to theme"

    validation:
      min_words: 30
      max_words: 200
      required_fields: [word, clue, length, category]

  # ============================================================
  # PATTERN MATCHING WORD GENERATION
  # Called during CSP solving when domain is empty
  # ============================================================
  pattern_word_generation:
    name: "Generate Words Matching Pattern"
    description: "Finds words that match a specific letter pattern during grid filling"
    max_calls: 25

    model: "claude-opus-4-5-20251101"  # Use Opus for semantic understanding in pattern matching
    temperature: 0.3
    max_tokens: 16384

    system: |
      You are a crossword puzzle word expert. Given a letter pattern,
      generate valid English words that match exactly. Focus on:
      - Common, well-known words preferred
      - Words appropriate for {{difficulty}} difficulty
      - If topic "{{topic}}" is relevant, prefer thematic words

    user: |
      Find words matching this pattern for a crossword puzzle:

      Pattern: {{pattern}}
      (where '.' represents unknown letters)

      Pattern length: {{length}} letters
      Topic context: {{topic}}
      Difficulty: {{difficulty}}

      Already used words (DO NOT repeat): {{used_words}}

      Provide {{count}} words that:
      1. Match the pattern EXACTLY
      2. Are real English words or well-known proper nouns
      3. Are appropriate for a {{difficulty}} crossword
      4. Are NOT in the already-used list

      Return words in order of preference (most common/appropriate first).

    output_format:
      type: yaml
      schema: |
        matching_words:
          - word: "MATCH"
            confidence: 0.95
            is_common: true

    validation:
      min_words: 1
      max_words: 20
      pattern_match_required: true

  # ============================================================
  # CLUE GENERATION
  # Called after grid is filled to generate clues for non-themed words
  # ============================================================
  clue_generation_batch:
    name: "Generate Clues for Words"
    description: "Creates crossword-style clues for a batch of words"
    max_calls: 5

    model: "claude-opus-4-5-20251101"  # Use Opus for better creativity in clue writing
    temperature: 0.8
    max_tokens: 16384

    system: |
      You are an expert crossword clue writer for {{difficulty}} difficulty
      puzzles. Write clues that are:
      - Appropriate for the difficulty level
      - Clever but fair
      - Grammatically correct
      - Free of offensive content

      Difficulty guidelines:
      - Monday/Tuesday: Straightforward definitions
      - Wednesday: Some wordplay, specific knowledge
      - Thursday: Tricky, misdirection allowed
      - Friday/Saturday: Cryptic, requires lateral thinking
      - Sunday: Medium difficulty with playful theme

    user: |
      Generate clues for these crossword answers at {{difficulty}} difficulty:

      {{word_list}}

      Puzzle topic: {{topic}}

      For each word, provide:
      1. A primary clue appropriate for {{difficulty}} level
      2. An alternate clue (different angle)

      If a word relates to "{{topic}}", the clue MAY reference the theme
      but should not make it too obvious.

    output_format:
      type: yaml
      schema: |
        clues:
          WORD1:
            primary: "Primary clue text"
            alternate: "Alternate clue text"
          WORD2:
            primary: "Primary clue text"
            alternate: "Alternate clue text"

    validation:
      all_words_clued: true

  # ============================================================
  # THEME DEVELOPMENT
  # Called when puzzle_type requires theme construction
  # ============================================================
  theme_development:
    name: "Develop Puzzle Theme"
    description: "Creates cohesive theme with revealer and themed entries"
    max_calls: 2

    model: "claude-sonnet-4-5-20250514"
    temperature: 0.9
    max_tokens: 16384

    system: |
      You are a professional crossword constructor specializing in themed
      puzzles. Create themes that are:
      - Fresh and interesting
      - Consistently applied
      - Accessible to general solvers
      - Clever without being obscure

    user: |
      Develop a {{puzzle_type}} theme for a crossword about "{{topic}}".

      Grid size: {{size}}x{{size}}
      Difficulty: {{difficulty}}
      Maximum words: {{max_words}}

      Theme type requirements:
      {{theme_type_requirements}}

      Provide:
      1. Theme concept explanation
      2. Revealer answer and clue (if applicable)
      3. 3-5 theme entries with clues
      4. How the entries connect to the revealer
      5. Suggested placement (long entries typically span the grid)

    output_format:
      type: yaml
      schema: |
        theme:
          concept: "Brief theme explanation"
          revealer:
            answer: "REVEALER"
            clue: "Revealer clue"
            explanation: "How it ties entries together"
          entries:
            - answer: "THEMEENTRY1"
              clue: "Clue for entry"
              theme_connection: "How it connects"

    validation:
      has_revealer: true
      min_theme_entries: 3

    theme_type_definitions:
      revealer: |
        Create a themed puzzle with a REVEALER entry that explains the theme connection.
        - The revealer should be a phrase that ties all theme entries together
        - Theme entries should share a common characteristic revealed by the revealer
        - Example: If theme entries hide animals, revealer might be "HIDDEN CREATURES"
        - Revealer is typically placed as a long across entry

      themeless: |
        Create a themeless puzzle focusing on quality fill and clever cluing.
        - No theme entries or revealer required
        - Emphasize interesting vocabulary and wordplay
        - Lower word count (max 72 for 15x15)
        - Friday/Saturday difficulty expected

      phrase_transformation: |
        Modify common phrases by adding/changing/removing elements related to the topic.
        - Each theme entry transforms a well-known phrase
        - The transformation must be consistent across all entries
        - Include a revealer explaining the transformation
        - Example: Adding "JAVA" to phrases for coffee theme: "JAVA THE HUT"

      hidden_words: |
        Conceal theme-related words within longer answer phrases.
        - Hidden words appear consecutively within the answer
        - All hidden words should be the same category
        - Include a revealer hinting at what's hidden
        - Example: "OVERDRAWN" hides DRAW for an art theme

      rebus: |
        Some squares contain multiple letters or a symbol.
        - All theme entries must incorporate the rebus element
        - The rebus should relate to the topic
        - Clearly indicate which squares are rebus squares
        - Example: Squares containing "HEART" for Valentine's theme

      puns: |
        Theme answers are puns or wordplay on the topic.
        - Each theme entry should be a groan-worthy pun
        - Puns should be accessible and not too obscure
        - Include a revealer that hints at the punny nature
        - Clues should set up the pun without giving it away

      add_a_letter: |
        Add a specific letter to common phrases to create new phrases.
        - The same letter is added to each theme entry
        - Resulting phrases should be humorous or surprising
        - Include a revealer indicating which letter was added
        - Example: Adding "B" creates "BRAIN CHECK" from "rain check"

      quote: |
        A famous quotation or quip spans multiple theme entries.
        - The quote is split across 3-4 long theme entries
        - Entries should be placed symmetrically
        - Attribution can be a separate entry or part of the quote
        - Choose quotes that are well-known and puzzle-appropriate

  # ============================================================
  # PUZZLE VALIDATION ASSIST
  # Called to verify puzzle quality and solvability
  # ============================================================
  validation_check:
    name: "Validate Puzzle Quality"
    description: "Reviews completed puzzle for quality and solvability"
    max_calls: 1

    model: null
    temperature: 0.3
    max_tokens: 16384

    system: |
      You are a crossword puzzle editor reviewing submissions. Evaluate:
      - Clue quality and appropriateness
      - Theme consistency
      - Fill quality (crosswordese, obscure words)
      - Overall solving experience

    user: |
      Review this completed crossword puzzle:

      Topic: {{topic}}
      Difficulty: {{difficulty}}

      Grid:
      {{grid}}

      Clues:
      {{clues}}

      Theme entries:
      {{theme_entries}}

      Evaluate:
      1. Are all clues solvable at {{difficulty}} level?
      2. Is the theme consistent and well-executed?
      3. Are there any problematic fill words?
      4. Would you recommend any clue improvements?

    output_format:
      type: yaml
      schema: |
        validation:
          overall_quality: 8
          solvable: true
          theme_quality: "good"
          issues:
            - type: "clue_issue"
              location: "14 Across"
              problem: "Clue too obscure"
              suggestion: "Consider simpler angle"
          recommendations:
            - "Consider changing 23 Down clue"

  # ============================================================
  # LOG ANALYSIS AND REPORT GENERATION
  # Called after puzzle generation to analyze execution logs
  # ============================================================
  log_analysis_report:
    name: "Analyze Generation Log"
    description: "Generates a narrative analysis report from puzzle generation logs"
    max_calls: 1

    model: "claude-3-5-haiku-20241022"  # Use Haiku 3.5 for cost-efficient analysis
    temperature: 0.5
    max_tokens: 8192  # Haiku 3.5 max output limit

    system: |
      You are a technical analyst reviewing crossword puzzle generation logs.
      Your goal is to provide a clear, actionable summary of the generation process,
      highlighting successes, bottlenecks, and recommendations for improvement.

    user: |
      Analyze this crossword puzzle generation log and create a comprehensive report.

      LOG METRICS:
      {{metrics}}

      KEY EVENTS:
      {{events}}

      WARNINGS AND ERRORS:
      {{warnings}}

      Generate a markdown report with these sections:

      # Crossword Generation Report
      Generated: {{timestamp}}

      ## Summary
      [2-3 paragraph narrative summary of the generation run]

      ## Performance Metrics
      - Total Runtime: X seconds
      - AI API Calls: X (under limit of Y)
      - Token Usage: X input / Y output
      - CSP Backtracks: X
      - Success Rate: X%

      ## Key Events
      [Chronological list of major events with timestamps]

      ## Issues Encountered
      [List issues with severity levels - CRITICAL, WARNING, INFO]

      ## Recommendations
      [Actionable suggestions for improving future runs]

      ## Detailed Logs
      See full logs at: [log filename]

    output_format:
      type: markdown
      schema: "Full markdown document with headers and formatting"

    validation:
      min_length: 500  # Ensure substantive report
      required_sections: ["Summary", "Performance Metrics", "Key Events"]
